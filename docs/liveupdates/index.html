<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.53">


<title data-react-helmet="true">AMQ Live updates | Open Volunteer Platform</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="AMQ Live updates | Open Volunteer Platform"><meta data-react-helmet="true" name="description" content="# Configuring AMQ Online for MQTT Messaging"><meta data-react-helmet="true" property="og:description" content="# Configuring AMQ Online for MQTT Messaging"><meta data-react-helmet="true" property="og:url" content="https://openvolunteer.org/docs/liveupdates">

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico">


<link rel="stylesheet" href="/styles.2fd7fc14.css">


<link rel="preload" href="/styles.51e8ab6a.js" as="script">

<link rel="preload" href="/runtime~main.c0293ee6.js" as="script">

<link rel="preload" href="/main.1e6a07b2.js" as="script">

<link rel="preload" href="/1.689f0228.js" as="script">

<link rel="preload" href="/2.793f4419.js" as="script">

<link rel="preload" href="/3.c3333f28.js" as="script">

<link rel="preload" href="/1be78505.82c346e8.js" as="script">

<link rel="preload" href="/20ac7829.0ccfc430.js" as="script">

<link rel="preload" href="/17896441.8fe54167.js" as="script">

<link rel="preload" href="/ad0aa9eb.89939183.js" as="script">

</head>
<body>

<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.png" alt="OpenVolunteerPlatform Logo"><strong class="navbar__title">OpenVolunteerPlatform</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/gettingstarted">Docs</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/aerogear/OpenVolunteerPlatform" class="navbar__item navbar__link">GitHub</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.png" alt="OpenVolunteerPlatform Logo"><strong class="navbar__title">OpenVolunteerPlatform</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="right" href="/docs/gettingstarted">Docs</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/aerogear/OpenVolunteerPlatform" class="menu__link" position="right">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gettingstarted">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/features">Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture">Architecture</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Reference Apps</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gettingstartedref">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding">Running reference application</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/clientref">Mobile and Admin Apps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/serverfullstack">Node.js server</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Customizations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/datamodel">Data Model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/keycloak-authz">Keycloak Auth</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" tabindex="0" href="/docs/liveupdates">AMQ Live updates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/adding-and-customizing-forms">Out of the box Form</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Tools</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/client">CLI commands</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">AMQ Live updates</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="configuring-amq-online-for-mqtt-messaging"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuring-amq-online-for-mqtt-messaging" title="Direct link to heading">#</a>Configuring AMQ Online for MQTT Messaging</h1><p>Red Hat AMQ supports the MQTT protocol which makes it a suitable Pubsub technology for powering GraphQL subscriptions at scale. This document provides recommendations for </p><ul><li>Configuring AMQ Online for MQTT messaging.</li><li>Connecting to AMQ Online and using it as a pubsub within server applications.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="terminology"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#terminology" title="Direct link to heading">#</a>Terminology</h2><p><a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.2/html-single/using_amq_online_on_openshift_container_platform/index#assembly-intro-using-messaging">AMQ Online</a> is a mechanism that allows developers to consume the features of Red Hat AMQ within OpenShift.</p><p><a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.3/html/introducing_red_hat_amq_7/about">Red Hat AMQ</a> provides fast, lightweight, and secure messaging for Internet-scale applications. AMQ Broker supports multiple protocols and fast message persistence.</p><p><a href="http://mqtt.org/">MQTT</a> stands for MQ Telemetry Transport. It is a publish/subscribe, extremely simple and lightweight messaging protocol.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="prerequisites"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#prerequisites" title="Direct link to heading">#</a>Prerequisites</h2><ul><li>OpenShift Cluster</li><li>AMQ Online is installed in the OpenShift cluster</li></ul><p>AMQ Online has a vast number of configuration options which should be considered to suit the specific needs of your application. This section establishes some base guidelines for configuring AMQ Online for MQTT messaging, enabling GraphQL subscriptions.</p><p>At a minimum, the following steps must be done to enable MQTT messaging.</p><ul><li>Create an AddressSpace</li><li>Create an Address</li><li>Create a MessagingUser</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="create-an-addressspace"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-an-addressspace" title="Direct link to heading">#</a>Create an AddressSpace</h2><p>A user can request messaging resources by creating an address space. An address space is the first resource you must create. There are two types of address spaces <code>standard</code> and <code>brokered</code>. The <code>brokered</code> address space must be used for MQTT based applications. The following definition can be used to create a brokered address space.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">apiVersion</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> enmasse</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">io</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">v1beta1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">kind</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">AddressSpace</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">metadata</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> myaddressspace</span></div><div class="token-line" style="color:#393A34"><span class="token plain">spec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> brokered</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  plan</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> brokered</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">single</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">broker</span></div></div></div></div></div><p>Create the address space.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">oc create </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">f brokered</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">address</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">space</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">yaml</span></div></div></div></div></div><p>Get the details of the address space.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">oc </span><span class="token keyword" style="color:#00009f">get</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">address space name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">o yaml</span></div></div></div></div></div><p>The output will display information including various connection details for connecting applications.</p><p>See <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.2/html-single/using_amq_online_on_openshift_container_platform/index#create-address-space-cli-messaging">Creating address spaces using the command line</a> for more information.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="create-an-address"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-an-address" title="Direct link to heading">#</a>Create an Address</h2><p>An address is part of an address space and represents a destination for sending and receiving messages. An address is created and used to represent a topic in MQTT terms. For MQTT, a <code>topic</code> address type must be used.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">apiVersion</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> enmasse</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">io</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">v1beta1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">kind</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Address</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">metadata</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> myaddressspace</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">myaddress</span><span class="token plain"> # must have the format </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">address space name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">address name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">spec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    address</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> myaddress</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> topic</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    plan</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> brokered</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">topic</span></div></div></div></div></div><p>Create the address using the command line.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">oc create </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">f topic</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">yaml</span></div></div></div></div></div><p>In the <a href="#define-subscriptions-in-the-schema-and-implement-subscription-resolvers">implementing subscription resolvers</a> guide, the usage of <code>pubsub.asyncIterator()</code> is described. An address must be created for each topic name passed into <code>pubsub.asyncIterator()</code>.</p><p>See <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.2/html-single/using_amq_online_on_openshift_container_platform/index#create-address-cli-messaging">Creating addresses using the command line</a> for more information.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="create-a-messaginguser"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-a-messaginguser" title="Direct link to heading">#</a>Create a MessagingUser</h2><p>A messaging client connects using a MessagingUser. A MessagingUser specifies an authorization policy that controls which addresses may be used and the operations that may be performed on those addresses.</p><p>Users are configured as MessagingUser resources. Users can be created, deleted, read, updated, and listed.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">apiVersion</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">enmasse</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">io</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">v1beta1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">kind</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">MessagingUser</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">metadata</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> myaddressspace</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mymessaginguser</span><span class="token plain"> # must be </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the format </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">address space name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">username</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">spec</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  username</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> mymessaginguser</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  authentication</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> password</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    password</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> cGFzc3dvcmQ</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> # must be </span><span class="token maybe-class-name">Base64</span><span class="token plain"> encoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token property-access maybe-class-name">Password</span><span class="token plain"> is </span><span class="token string" style="color:#e3116c">&#x27;password&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  authorization</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> addresses</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;*&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      operations</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;send&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;recv&quot;</span><span class="token punctuation" style="color:#393A34">]</span></div></div></div></div></div><p>Create the messaging user.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">oc create </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">f my</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">messaging</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">yaml</span></div></div></div></div></div><p>An application can now connect to an AMQ Online address using this <code>MessagingUser</code>&#x27;s credentials. For more information see <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.2/html-single/using_amq_online_on_openshift_container_platform/index#con-user-model-messaging">AMQ Online User Model</a>.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="using-graphql-mqtt-pubsub-with-amq-online"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-graphql-mqtt-pubsub-with-amq-online" title="Direct link to heading">#</a>Using GraphQL MQTT PubSub with AMQ Online</h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="prerequisites-1"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#prerequisites-1" title="Direct link to heading">#</a>Prerequisites</h2><ul><li>OpenShift cluster</li><li>AMQ Online is installed in the OpenShift cluster</li><li>The appropriate AMQ Online resources are available for MQTT Applications (AddressSpace, Address, MessagingUser)</li></ul><p>This guide describes how to use <a href="https://npm.im/@aerogear/graphql-mqtt-subscriptions"><code>@aerogear/graphql-mqtt-subscriptions</code></a> to connect to an AMQ Online address.</p><p>The connection details for an Address Space can be retrieved from the terminal.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">oc </span><span class="token keyword" style="color:#00009f">get</span><span class="token plain"> addressspace </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">addressspace</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">o yaml</span></div></div></div></div></div><p>In most cases, there are two options for connecting to an AMQ Online address.</p><ul><li>Using the service hostname - Allows clients to connect from within the OpenShift cluster.</li><li>Using the external hostname - Allows clients to connect from outside the OpenShift cluster.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="connecting-to-an-amq-online-address-using-the-service-hostname"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#connecting-to-an-amq-online-address-using-the-service-hostname" title="Direct link to heading">#</a>Connecting to an AMQ Online Address Using the Service Hostname</h2><p>It is recommended that applications running inside OpenShift connect using the service hostname. The service hostname is only accessible within the OpenShift cluster. This ensures messages routed between your application and AMQ Online stay within the OpenShift cluster and never go onto the public internet.</p><p>The service hostname can be retrieved using the terminal.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">oc get addressspace </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">addressspace name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> -o </span><span class="token assign-left variable" style="color:#36acaa">jsonpath</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">&#x27;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">.status.endpointStatuses</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">?</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@.name</span><span class="token operator" style="color:#393A34">==</span><span class="token string" style="color:#e3116c">&quot;messaging&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.serviceHost</span></div></div></div></div></div><p>Once you have the AMQ address and credentials, open the <code>server/.env</code> file and update the MQTT section accordingly.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">## </span><span class="token constant" style="color:#36acaa">MQTT</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">MQTT_HOST</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">MQTT_PORT</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">MQTT_PASSWORD</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">MQTT_USERNAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">MQTT_PROTOCOL</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="troubleshooting-mqtt-connection-issues"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#troubleshooting-mqtt-connection-issues" title="Direct link to heading">#</a>Troubleshooting MQTT Connection Issues</h2><p>The <code>server/src/pubsub.ts</code> contains code that creates connection to MQTT or an in memory pub sub topic.</p><p>In this section we are going to see how to log events and fixing configuration issues by modifying the source code in the mentioned file. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="events"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#events" title="Direct link to heading">#</a>Events</h3><p>The <code>mqtt</code> module emits various events during runtime.
It recommended to add listeners for these events for regular operation and for troubleshooting.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-ts codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;connect&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;client has connected&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;reconnect&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;client has reconnected&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;offline&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Client has gone offline&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;error&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">an error has occurred </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">error</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div></div></div><p>Read the <a href="https://www.npmjs.com/package/mqtt"><code>mqtt documentation</code></a> to learn about all of the events and what causes them.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="configuration-issues"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuration-issues" title="Direct link to heading">#</a>Configuration Issues</h3><p>If your application is experiencing connection errors, the most important thing to check is the configuration being passed into <code>mqtt.connect</code>. Because your application may run locally or in OpenShift, it may connect using internal or external hostnames, and it may or may not use TLS, it&#x27;s very easy to accidentally provide the wrong configuration.</p><p>The Node.js <code>mqtt</code> module does not report any errors if parameters such as <code>hostname</code> or <code>port</code> are incorrect. Instead, it will silently fail and allow your application to start without messaging capabilities.</p><p>It may be necessary to handle this scenario in your application. The following workaround can be used.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-ts codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TIMEOUT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// number of seconds to wait before checking if the client is connected</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">connected</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">client not connected after </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation constant" style="color:#36acaa">TIMEOUT</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c"> seconds</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// process.exit(1) if you wish</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TIMEOUT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div></div></div><p>This code can be used to detect if the MQTT client hasn&#x27;t connected. This can be helpful for detecting potential configuration issues and allows your application to respond to that scenario.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/aerogear/OpenVolunteerPlatform/edit/master/website/../docs/deployments_subscriptions_amq.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/keycloak-authz"><div class="pagination-nav__link--sublabel">Previous</div><div class="pagination-nav__link--label">« Out of the box Keycloak based authentication</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/adding-and-customizing-forms"><div class="pagination-nav__link--sublabel">Next</div><div class="pagination-nav__link--label">Out of the box Form »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#terminology" class="contents__link">Terminology</a></li><li><a href="#prerequisites" class="contents__link">Prerequisites</a></li><li><a href="#create-an-addressspace" class="contents__link">Create an AddressSpace</a></li><li><a href="#create-an-address" class="contents__link">Create an Address</a></li><li><a href="#create-a-messaginguser" class="contents__link">Create a MessagingUser</a></li><li><a href="#prerequisites-1" class="contents__link">Prerequisites</a></li><li><a href="#connecting-to-an-amq-online-address-using-the-service-hostname" class="contents__link">Connecting to an AMQ Online Address Using the Service Hostname</a></li><li><a href="#troubleshooting-mqtt-connection-issues" class="contents__link">Troubleshooting MQTT Connection Issues</a><ul><li><a href="#events" class="contents__link">Events</a></li><li><a href="#configuration-issues" class="contents__link">Configuration Issues</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/gettingstarted">Introduction</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://discordapp.com/invite/mJ7j84m">Discord</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://github.com/aerogear/OpenVolunteerPlatform">GitHub</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://aerogear.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1Wg7"><img class="footer__logo" alt="AeroGear Logo" src="/img/aerogear.png"></a></div><div>Copyright © 2020 AeroGear</div></div></div></footer>
</div>

<script src="/styles.51e8ab6a.js"></script>

<script src="/runtime~main.c0293ee6.js"></script>

<script src="/main.1e6a07b2.js"></script>

<script src="/1.689f0228.js"></script>

<script src="/2.793f4419.js"></script>

<script src="/3.c3333f28.js"></script>

<script src="/1be78505.82c346e8.js"></script>

<script src="/20ac7829.0ccfc430.js"></script>

<script src="/17896441.8fe54167.js"></script>

<script src="/ad0aa9eb.89939183.js"></script>


</body>
</html>